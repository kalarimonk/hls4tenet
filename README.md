
# High Level Synthesis (HLS) based Hardware Implementation of Tree Tensor Networks (TTN)

This project is developed to provide a HLS based framework to ease the design and hardware implementation of tensor networks on hardware accelerators like FPGAs with the primary application being classification of jet-substructure in the field of High Energy Physics (HEP). 


**Prerequisites**:  `Vitis_HLS`, `Vivado`, `Python3`

## Directory structure and project setup

The repository is organized as follows:

```
.
├── README.md
├── datasets
│    ...
├── hls_config.cfg
├── hls_contraction.h
├── hls_dispatcher.cpp
├── hls_dispatcher.h
├── hls_tenet.cpp
├── hls_tenet.h
├── hls_tensor.h
├── hls_weights.h
├── results
│    ...
├── run_tenet
│    ...
├── tenet_tb.cpp
├── utilities
│   ├── NumpyProcessor.py
│   ├── data_quantization.cpp
│   ├── header_templates
│   │    |── dispatcher.h.in
│   │    |── tenet.h.in
│   │    |── tensors.h.in
│   ├── old_misc
│   └── setup.py

```

The folders `datasets` and `results` are representation where the datasets and results can be placed. 

After cloning the repository create a `Vitis_HLS` project and add the following files as sources and test bench. The `run_tenet` folder above is the folder generated by `Vitis_HLS` ide which hosts the compiled executables and the synthesized Vivado IP files.

```
├── sources
│   ├── hls_contraction.h
│   ├── hls_dispatcher.cpp
│   ├── hls_dispatcher.h
│   ├── hls_tenet.cpp
│   ├── hls_tenet.h
│   ├── hls_tensor.h
│   ├── hls_weights.h
├── Test Bench
│   └── tenet_tb.cpp

```


### Data Preprocessing Pipeline

Before proceeding with the Vitis HLS simulation and synthesis, the header files need to be updated according to the dataset for which the design is being implemented. The dataset and the model weights obtained for the software phase are provided as `.npy` and `.npz` numpy formats respectively.

The `utilities` folder contains file to process and transform these files into the requisite formats (here `.bin` and `.txt` ) and retrieve the metadata and values about the tree tensor network to generate the headers with the templates under `header_templates` folder

Usage:

```python
$ python setup.py --help
usage: setup.py [-h] [--top-iso-ttn] directory_path

Process the dataset to obtain binaries for HLS processing

positional arguments:
  directory_path  Path to the dataset to be processed

optional arguments:
  -h, --help      show this help message and exit
  --top-iso-ttn   Top-Isometrized TTN


Example: 
1. python setup.py ../datasets/set1 
2. python setup.py ../datasets/set2 --top-iso-ttn

```

### Vitis HLS setup

After preprocessing the data, the design can be validated by running the C-simulation in Vitis. The simulation uses the `tenet_tb.cpp` file as the test bench. The arguments to the test bench must be updated in the `hls_config.cfg` configuration file as follows.

```
csim.argv = <weights_file> <input_data_file> <output_results_file>

```

The configuration file along with this also contains the main configuration of the project like the part name, clock and other csim/synthesis parameters.



### Vivado setup

To be added

### Host Machine setup

To be added





